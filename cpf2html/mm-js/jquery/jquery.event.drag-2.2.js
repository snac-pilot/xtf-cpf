/*! 
 * jquery.event.drag - v 2.2
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */
!function(t){t.fn.drag=function(e,n,a){var o="string"==typeof e?e:"",r=t.isFunction(e)?e:t.isFunction(n)?n:null;return 0!==o.indexOf("drag")&&(o="drag"+o),a=(e==r?n:a)||{},r?this.bind(o,a,r):this.trigger(o)};var e=t.event,n=e.special,a=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(e){var n=t.data(this,a.datakey),o=e.data||{};n.related+=1,t.each(a.defaults,function(t){void 0!==o[t]&&(n[t]=o[t])})},remove:function(){t.data(this,a.datakey).related-=1},setup:function(){if(!t.data(this,a.datakey)){var n=t.extend({related:0},a.defaults);t.data(this,a.datakey,n),e.add(this,"touchstart mousedown",a.init,n),this.attachEvent&&this.attachEvent("ondragstart",a.dontstart)}},teardown:function(){var n=t.data(this,a.datakey)||{};n.related||(t.removeData(this,a.datakey),e.remove(this,"touchstart mousedown",a.init),a.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",a.dontstart))},init:function(o){if(!a.touched){var r,i=o.data;if(!(0!=o.which&&i.which>0&&o.which!=i.which||t(o.target).is(i.not)||i.handle&&!t(o.target).closest(i.handle,o.currentTarget).length||(a.touched="touchstart"==o.type?this:null,i.propagates=1,i.mousedown=this,i.interactions=[a.interaction(this,i)],i.target=o.target,i.pageX=o.pageX,i.pageY=o.pageY,i.dragging=null,r=a.hijack(o,"draginit",i),!i.propagates)))return r=a.flatten(r),r&&r.length&&(i.interactions=[],t.each(r,function(){i.interactions.push(a.interaction(this,i))})),i.propagates=i.interactions.length,i.drop!==!1&&n.drop&&n.drop.handler(o,i),a.textselect(!1),a.touched?e.add(a.touched,"touchmove touchend",a.handler,i):e.add(document,"mousemove mouseup",a.handler,i),!a.touched||i.live?!1:void 0}},interaction:function(e,n){var o=t(e)[n.relative?"position":"offset"]()||{top:0,left:0};return{drag:e,callback:new a.callback,droppable:[],offset:o}},handler:function(o){var r=o.data;switch(o.type){case!r.dragging&&"touchmove":o.preventDefault();case!r.dragging&&"mousemove":if(Math.pow(o.pageX-r.pageX,2)+Math.pow(o.pageY-r.pageY,2)<Math.pow(r.distance,2))break;o.target=r.target,a.hijack(o,"dragstart",r),r.propagates&&(r.dragging=!0);case"touchmove":o.preventDefault();case"mousemove":if(r.dragging){if(a.hijack(o,"drag",r),r.propagates){r.drop!==!1&&n.drop&&n.drop.handler(o,r);break}o.type="mouseup"}case"touchend":case"mouseup":default:a.touched?e.remove(a.touched,"touchmove touchend",a.handler):e.remove(document,"mousemove mouseup",a.handler),r.dragging&&(r.drop!==!1&&n.drop&&n.drop.handler(o,r),a.hijack(o,"dragend",r)),a.textselect(!0),r.click===!1&&r.dragging&&t.data(r.mousedown,"suppress.click",(new Date).getTime()+5),r.dragging=a.touched=!1}},hijack:function(n,o,r,i,s){if(r){var l,d,c,u={event:n.originalEvent,type:n.type},p=o.indexOf("drop")?"drag":"drop",h=i||0,g=isNaN(i)?r.interactions.length:i;n.type=o,n.originalEvent=null,r.results=[];do if(d=r.interactions[h]){if("dragend"!==o&&d.cancelled)continue;c=a.properties(n,r,d),d.results=[],t(s||d[p]||r.droppable).each(function(i,s){return c.target=s,n.isPropagationStopped=function(){return!1},l=s?e.dispatch.call(s,n,c):null,l===!1?("drag"==p&&(d.cancelled=!0,r.propagates-=1),"drop"==o&&(d[p][i]=null)):"dropinit"==o&&d.droppable.push(a.element(l)||s),"dragstart"==o&&(d.proxy=t(a.element(l)||d.drag)[0]),d.results.push(l),delete n.result,"dropinit"!==o?l:void 0}),r.results[h]=a.flatten(d.results),"dropinit"==o&&(d.droppable=a.flatten(d.droppable)),"dragstart"!=o||d.cancelled||c.update()}while(++h<g);return n.type=u.type,n.originalEvent=u.event,a.flatten(r.results)}},properties:function(t,e,n){var o=n.callback;return o.drag=n.drag,o.proxy=n.proxy||n.drag,o.startX=e.pageX,o.startY=e.pageY,o.deltaX=t.pageX-e.pageX,o.deltaY=t.pageY-e.pageY,o.originalX=n.offset.left,o.originalY=n.offset.top,o.offsetX=o.originalX+o.deltaX,o.offsetY=o.originalY+o.deltaY,o.drop=a.flatten((n.drop||[]).slice()),o.available=a.flatten((n.droppable||[]).slice()),o},element:function(t){return t&&(t.jquery||1==t.nodeType)?t:void 0},flatten:function(e){return t.map(e,function(e){return e&&e.jquery?t.makeArray(e):e&&e.length?a.flatten(e):e})},textselect:function(e){t(document)[e?"unbind":"bind"]("selectstart",a.dontstart).css("MozUserSelect",e?"":"none"),document.unselectable=e?"off":"on"},dontstart:function(){return!1},callback:function(){}};a.callback.prototype={update:function(){n.drop&&this.available.length&&t.each(this.available,function(t){n.drop.locate(this,t)})}};var o=e.dispatch;e.dispatch=function(e){return t.data(this,"suppress."+e.type)-(new Date).getTime()>0?(t.removeData(this,"suppress."+e.type),void 0):o.apply(this,arguments)};var r=e.fixHooks.touchstart=e.fixHooks.touchmove=e.fixHooks.touchend=e.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(e,n){if(n){var a=n.touches&&n.touches[0]||n.changedTouches&&n.changedTouches[0]||null;a&&t.each(r.props,function(t,n){e[n]=a[n]})}return e}};n.draginit=n.dragstart=n.dragend=a}(jQuery);